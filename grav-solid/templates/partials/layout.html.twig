{% spaceless %}


	{# TODO : Charger les propriété solid json dans le thème si dispo, et ajouter la version après les ressources CSS / JS #}
	{# TODO : Faire en sorte que les clé du dico se transforment en arborescence. Vraiment utile ? Pas trop lourd ? #}
	{# TODO : Voir pour cette histoire de template par défaut + les templates contenu VS template de page avec que des data #}
	{# TODO : Vérifier que la moulinette injectData dans le PHP soit bien mise en cache et si ça ne pose pas de soucis en cache #}



	{# FIXME Still useful ? #}
	{% set theme_config = attribute(config.themes, config.system.pages.theme) %}

	{# Get current locale or default locale #}
	{% set locale = html_lang %}

	{# Get meta title from page and fallback to website name if not available #}
	{% set title = header.title ?: site.title %}

	{# Get meta description from page if defined #}
	{% set description = "" %}
	{% if page.header.description is defined %}
		{% set description = page.header.description ?: '' %}
	{% endif %}

	{# Get canonical URL from current page, or target current URL if not set #}
	{% set canonical = canonical() ?: page.url(true, true) %}

	{# Get facebook and twitter site names from config #}
	{% set facebookSiteName = appData.globals.meta.facebookSite ?: '' %}
	{% set twitterSiteName = appData.globals.meta.twitterSite ?: '' %}

	{# Get share title from page or clone page title if not defined #}
	{% set shareTitle = title %}
	{% if page.header.custom.shareTitle is defined %}
		{% set shareTitle = page.header.custom.shareTitle %}
	{% endif %}

	{# Get share description from page or clone page description if not defined #}
	{% set shareDescription = description %}
	{% if page.header.custom.shareDescription is defined %}
		{% set shareDescription = page.header.custom.shareDescription %}
	{% endif %}

	{# TODO #}
	{# Get share image #}
	{% set shareImage = base_url_absolute %}
	{# TODO Twitter image doc : https://developer.twitter.com/en/docs/tweets/optimize-with-cards/overview/summary-card-with-large-image.html #}
	{# TODO Facebook  https://developers.facebook.com/docs/sharing/webmasters?locale=fr_FR #}
	{# TODO : Attention les url twitter et FB ne doivent pas contenir de paramètres etc, a tester donc car que retourne vraiment canonical ? #}

{% endspaceless %}<!DOCTYPE html>
<html lang="{{ locale }}">
<head>
	{% block head %}

    <meta charset="UTF-8">
    <meta http-equiv="imagetoolbar" content="no">
    <meta http-equiv="x-ua-compatible" content="IE=Edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

		{# TODO : Faire une option dans le thème pour ça #}
    <!--
         ___ _                                 _
        / __\ |__   ___ _ __    __ _ _ __ ___ (_)
       / /  | '_ \ / _ \ '__|  / _` | '_ ` _ \| |
      / /___| | | |  __/ |    | (_| | | | | | | |_
      \____/|_| |_|\___|_|     \__,_|_| |_| |_|_( )
                                                |/

      Creative & interactive studio.
      We craft immersive & emotional experiences for people and brands.

      See our work : http://cher-ami.tv
      Contact us : contact@cher-ami.tv
    -->

    <!-- PAGE META -->
    <title>{{ title|e('html') }}</title>
    <meta name="description" content="{{ description|e('html_attr') }}">
    <link rel="canonical" href="{{ canonical }}">

    <!-- FACEBOOK -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="{{ facebookSiteName|e('html_attr') }}">
		<meta property="og:url" content="{{ canonical }}">
    <meta property="og:title" content="{{ shareTitle|e('html_attr') }}">
    <meta property="og:description" content="{{ shareDescription|e('html_attr') }}">
    <meta property="og:image" content="{{ shareImage }}">

    <!-- TWITTER -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="{{ twitterSiteName|e('html_attr') }}">
    <meta name="twitter:url" content="{{ canonical }}">
    <meta name="twitter:title" content="{{ shareTitle|e('html_attr') }}">
    <meta name="twitter:description" content="{{ shareDescription|e('html_attr') }}">
    <meta name="twitter:image" content="{{ shareImage }}">

    <!-- DYNAMIC META -->
    {% spaceless %}
      {# Remove useless meta #}
      {% for meta in page.metadata %}
        {% if meta.name != "generator" and meta.name != "description" %}
          <meta {% if meta.name %}name="{{ meta.name }}" {% endif %}{% if meta.http_equiv %}http-equiv="{{ meta.http_equiv }}" {% endif %}{% if meta.charset %}charset="{{ meta.charset }}" {% endif %}{% if meta.property %}property="{{ meta.property }}" {% endif %}{% if meta.content %}content="{{ meta.content }}" {% endif %}/>
        {% endif %}
      {% endfor %}
    {% endspaceless %}

	{% endblock head %}
</head>
<body>

	<!-- PRELOADER -->
	<div class="PreLoader"></div>

	{% if false %}
		<!-- GRAV ASSETS -->
		{{ assets.css('head') }}
		{{ assets.js('head') }}
	{% endif %}

	<!-- MAIN APP CONTAINER -->
	<div id="AppContainer">
		{# TODO : Attention le contenu est duppliqué avec l'app-data, ajouter une prop solid pour inject content ? #}
		{# TODO : Ou alors on l'inject s'il existe et on le supprime de l'app data ? Du coup comment on fait pour les pages autres que la page en cours ? #}
		{% block pageContent %}{% endblock %}
	</div>
</body>

<!-- APP DATA -->
<script>
	window.__appData = {{ appData | json_encode(constant('JSON_NUMERIC_CHECK')) | raw }};
</script>

<!-- SOLID BOOTSTRAP -->
<script>
	function SolidBundleLoaded (appName, App)
	{
		(appName === 'main') && new App({
			root: document.getElementById('AppContainer'),
			locale: '{{ locale }}',
			base: '{{ base_url }}/',
			currentHref: '{{ page.url }}',
			appData: __appData
		});
	}
</script>

<!-- SOLID BUNDLES -->
<script src="{{ base_url }}/static/bundles/bundle.js"></script>
<link rel="stylesheet" href="{{ base_url }}/static/bundles/bundle.css" />

{% if appData.globals.config.keys.analytics is defined and appData.globals.config.keys.analytics is not empty %}
<!-- ANALYTICS -->
<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

	ga('create', '{{ appData.globals.config.keys.analytics }}', 'auto');
	ga('send', 'pageview');
</script>
{% endif %}

</html>